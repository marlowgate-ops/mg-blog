---
import { getEntryBySlug } from 'astro:content';
export const prerender = true;

const { slug } = Astro.params;
const entry = await getEntryBySlug('blog', slug);
if (!entry) {
  return Astro.redirect('/');
}

const { Content } = await entry.render();
const fm = entry.data ?? {};
const title = fm.title ?? 'Untitled';
const description = fm.description ?? '';
const ogImage = fm.ogImage ?? 'https://marlowgate.com/og/blog-default_v1.png';
const pubDate = fm.pubDate ? new Date(fm.pubDate) : null;
const updatedDate = fm.updatedDate ? new Date(fm.updatedDate) : null;

const pageTitle = `${title} | Marlow Gate`;
const canonical = Astro.site ? new URL(Astro.url.pathname, Astro.site).href : Astro.url.pathname;
---
<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{pageTitle}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonical} />
    <meta property="og:site_name" content="Marlow Gate" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={pageTitle} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage} />
    <style>
      :root { --bg:#0b1220; --txt:#e8ecff; --muted:#aabbdB; --link:#40ccd5; --card:#121a2b; }
      *{box-sizing:border-box}
      body{margin:0;background:var(--bg);color:var(--txt);font:16px/1.65 system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans JP',sans-serif}
      a{color:var(--link);text-decoration:none} a:hover{text-decoration:underline}
      .container{max-width:960px;margin:0 auto;padding:24px}
      .card{background:var(--card);border-radius:14px;padding:18px}
      header.nav{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
      footer{margin:36px 0 20px;color:var(--muted)}
    </style>
  </head>
  <body>
    <div class="container">
      <header class="nav">
        <a href="/">Marlow Gate</a>
        <nav>
          <a href="/">Blog</a>
          <a href="/calendars/">Calendars</a>
          <a href="https://store.marlowgate.com">Store</a>
        </nav>
      </header>
      <article class="card">
        <h1>{title}</h1>
        {(pubDate || updatedDate) && (
          <p style="color:var(--muted);margin-top:4px;">
            {pubDate && `公開: ${pubDate.toLocaleDateString('ja-JP')}`}
            {updatedDate && ` / 更新: ${updatedDate.toLocaleDateString('ja-JP')}`}
          </p>
        )}
        <Content />
      </article>
      <footer>© {new Date().getFullYear()} Marlow Gate</footer>
    </div>
  </body>
</html>
