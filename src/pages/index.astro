---
import Hero from "../components/Hero.astro";
import PostCard from "../components/PostCard.astro";

// Use only literal string arguments with Astro.glob (required by Vite parser)
const g1 = await Astro.glob("./blog/*.{md,mdx}");
const g2 = await Astro.glob("./blog/**/*.{md,mdx}");
const g3 = await Astro.glob("../content/blog/*.{md,mdx}");
const g4 = await Astro.glob("../content/blog/**/*.{md,mdx}");

const groups = [...g1, ...g2, ...g3, ...g4];

const posts = groups
  .filter((p) => p?.frontmatter?.draft !== true)
  .map((p) => ({
    href: p?.url || p?.frontmatter?.url || "#",
    title: p?.frontmatter?.title || p?.title || "Untitled",
    description: p?.frontmatter?.description || p?.description || "",
    date: p?.frontmatter?.pubDate || p?.frontmatter?.date || null,
    raw: p,
  }))
  .sort((a, b) => {
    const da = a.date ? new Date(a.date).getTime() : 0;
    const db = b.date ? new Date(b.date).getTime() : 0;
    return db - da;
  })
  .slice(0, 3);
---

<Hero title="Trading data & automation â€” insights and releases" subtitle="Latest articles and updates from Marlow Gate" ctaHref="/store/" ctaLabel="Go to Store" />

<section style="padding:28px 20px;">
  <div style="max-width:900px; margin:0 auto; display:grid; grid-template-columns:1fr; gap:16px;">
    {posts.length === 0 ? (
      <div style="color:#666;">No posts yet. Add <code>*.md</code> or <code>*.mdx</code> under <code>src/pages/blog/</code> or <code>src/content/blog/</code>.</div>
    ) : (
      posts.map((p) => <PostCard post={p.raw} />)
    )}
  </div>
</section>
